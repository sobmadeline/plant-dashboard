<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><script src="https://cdn.tailwindcss.com"></script><link rel="stylesheet" href="./assets/app.css"/><script src="./assets/app.js"></script><title>New Refusal</title></head><body class='bg-slate-50' onload='guard();initDefaults();'>
<header class="bg-slate-900 text-white px-4 py-3 flex items-center justify-between gap-3 no-print">
  <div class="font-extrabold">New Refusal</div>
  <div class="flex items-center gap-3">
    <span id="whoami" class="text-white/90 text-sm font-semibold"></span>
    <button class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 font-bold" onclick="doLogout()">Logout</button>
  </div>
</header>
<div id="toast" class="hidden fixed top-4 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-4 py-3 rounded-xl shadow-lg z-50 no-print"></div>

<main class="max-w-4xl mx-auto p-4"><div class="bg-white border rounded-2xl p-5 shadow-sm">
<div class="grid md:grid-cols-2 gap-4">
<label class="block"><div class="text-xs font-bold">Date</div><input id="refusal_date" type="date" class="mt-1 w-full border rounded-xl p-2"></label>
<label class="block"><div class="text-xs font-bold">Time</div><input id="refusal_time" type="time" class="mt-1 w-full border rounded-xl p-2"></label>
<label class="block md:col-span-2"><div class="text-xs font-bold">Location</div><input id="location" class="mt-1 w-full border rounded-xl p-2"></label>
<label class="block"><div class="text-xs font-bold">Reason</div><input id="reason" class="mt-1 w-full border rounded-xl p-2"></label>
<label class="block"><div class="text-xs font-bold">CCTV</div><select id="cctv_available" class="mt-1 w-full border rounded-xl p-2"><option value="">Unknown</option><option value="1">Yes</option><option value="0">No</option></select></label>
<label class="block md:col-span-2"><div class="text-xs font-bold">Comments</div><textarea id="comments" rows="5" class="mt-1 w-full border rounded-xl p-2"></textarea></label>
<label class="block"><div class="text-xs font-bold">Approved manager</div><input id="approved_manager_name" class="mt-1 w-full border rounded-xl p-2"></label>
<label class="flex items-center gap-2 mt-6"><input id="police_notified" type="checkbox">Police notified</label>
</div>
<div class="mt-4 flex gap-2 justify-end"><a href="./index.html" class="px-4 py-2 rounded-xl border font-bold">Cancel</a>
<button class="px-4 py-2 rounded-xl bg-emerald-600 text-white font-extrabold" onclick="submitRefusal()">Save</button></div>
</div></main>
<script>
function initDefaults(){const d=new Date();qs('#refusal_date').value=d.toISOString().slice(0,10);qs('#refusal_time').value=d.toTimeString().slice(0,5);}
async function submitRefusal(){
  try{
    const payload={refusal_date:qs('#refusal_date').value,refusal_time:qs('#refusal_time').value,location:qs('#location').value,
      cctv_available:qs('#cctv_available').value===''?null:Number(qs('#cctv_available').value),
      reason:qs('#reason').value,comments:qs('#comments').value,approved_manager_name:qs('#approved_manager_name').value,
      police_notified:qs('#police_notified').checked?1:0};
    const out=await api('./api/refusals_create.php',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    toast('Saved '+out.refusal_no);location.href='./view_refusal.html?id='+out.id;
  }catch(e){toast(e.message);}
}
</script></body></html>
